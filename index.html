<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Champions Chess IFMA</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css"/>
  <style>
    /* Pequenos ajustes para garantir funcionamento imediato */
    html, body { margin: 0; }
    .tabs.topbar { margin: 0; }
    /* Apostas: mais espaço entre cartões */
    #apostas .grid-2 { gap: 24px; }
    #apostas .card { margin-bottom: 18px; }
  </style>
</head>
<body>
  <!-- NAVBAR (TOPBAR) -->
  <nav class="tabs topbar" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
    <div class="nav-left" style="display:flex;align-items:center;gap:10px">
      <img src="logo.png" alt="Champions Chess IFMA" class="logo" style="width:36px;height:36px;border-radius:50%;object-fit:cover">
      <strong>Champions Chess IFMA</strong>
    </div>
  
    <div class="nav-center" style="display:flex;gap:8px;flex:1;justify-content:center">
      <button class="tab active" data-tab="home">Home</button>
      <button class="tab" data-tab="regulamento">Regulamento</button>
      <button class="tab" data-tab="partidas">Partidas</button>
      <button class="tab" data-tab="tabela">Tabela</button>
      <button class="tab" data-tab="players">Players</button>
      <button class="tab" data-tab="posts">Post</button>
      <button class="tab" data-tab="apostas">Apostas</button>
      <button class="tab" data-tab="chat">Chat</button>
      <button class="tab" data-tab="perfil">Perfil</button>
      <button id="tab-admin" class="tab admin-only hidden" data-tab="admin">Admin</button>
    </div>
  
    <div class="nav-right" style="display:flex;align-items:center;gap:8px">
      <div id="user-chip" class="chip hidden" title="Abrir perfil" style="cursor:pointer">
        <span id="user-email"></span>
        <span id="admin-badge" class="badge hidden">ADMIN</span>
      </div>
      <button id="btn-open-login" class="btn ghost">Entrar com Google</button>
      <button id="btn-logout" class="btn danger hidden">Sair</button>
    </div>
  </nav>

  <main class="container">
    <!-- HOME -->
    <section id="home" class="view visible">
      <div class="grid-2">
        <div class="card">
          <h2>Bem-vindo ao Champions Chess IFMA</h2>
          <p>Este é o hub oficial do campeonato de xadrez do IFMA. Aqui você encontra partidas, tabela de pontuação, jogadores e avisos.</p>
          <ul class="list">
            <li><b>Formato:</b> 10 jogadores, divididos em dois grupos (A e B) com 5 cada;</li>
            <li><b>Fase de grupos:</b> todos jogam entre si (5 rodadas). Pontuação: vitória 3, empate 1, derrota 0;</li>
            <li><b>Classificação (G2):</b> os 2 melhores de cada grupo avançam às semifinais (1ºA×2ºB e 1ºB×2ºA);</li>
            <li><b>Mata-mata:</b> Semifinais → Final e disputa de 3º lugar;</li>
            <li><b>Transparência:</b> Partidas devem ser comunicadas no grupo e validadas com print/monitor;</li>
            <li><b>Organização:</b> Use a aba <i>Partidas</i> para datas/códigos e a aba <i>Post</i> para comunicados.</li>
          </ul>
          <div class="cta-row">
            <a class="btn" href="#regulamento" onclick="location.hash='regulamento'">Ver Regulamento</a>
            <a class="btn ghost" href="ChampionsChessIFMA.pdf" target="_blank" rel="noopener">Abrir PDF</a>
            <a class="btn ghost" href="#players" onclick="location.hash='players'">Lista de Players</a>
          </div>
        </div>
        <div class="card">
          <h2>Próximas partidas (hoje/próximo dia)</h2>
          <div id="home-next" class="table"></div>
        </div>
      </div>

      <div class="card home-posts">
        <h2>Últimos comunicados</h2>
        <div id="home-posts" class="posts"></div>
      </div>
    </section>

    <!-- REGULAMENTO -->
    <section id="regulamento" class="view">
      <div class="grid-2">
        <div class="card">
          <h2>Regulamento</h2>
          <h3>Fase de Grupos</h3>
          <ul class="list">
            <li>2 grupos de 5 jogadores (A e B); todos se enfrentam no grupo (5 rodadas);</li>
            <li><b>Pontuação:</b> Vitória 3 pts · Empate 1 pt · Derrota 0 pt;</li>
            <li><b>Desempate:</b> confronto direto → nº de vitórias → sorteio;</li>
            <li>Resultados válidos somente com print no grupo ou confirmação do monitor.</li>
          </ul>
          <h3>Mata-Mata</h3>
          <ul class="list">
            <li>Semifinal 1: 1ºA × 2ºB · Semifinal 2: 1ºB × 2ºA;</li>
            <li>Final entre os vencedores; disputa de 3º lugar entre os derrotados;</li>
            <li>Partidas podem ser <b>adiadas</b> em caso justificado e remarcadas via organização.</li>
          </ul>
          <h3>Conduta</h3>
          <ul class="list">
            <li>Respeito obrigatório entre os participantes e monitores;</li>
            <li>Sem uso de auxílio ilegal (motores durante a partida);</li>
            <li>Comunicar início das partidas no grupo; WO em caso de ausência injustificada.</li>
          </ul>
        </div>
        <div class="card">
          <h2>PDF (pré-visualização)</h2>
          <div class="pdf-wrap">
            <object data="ChampionsChessIFMA.pdf" type="application/pdf" width="100%" height="540">
              <p>Não foi possível exibir o PDF.
                <a class="btn" href="ChampionsChessIFMA.pdf" target="_blank" rel="noopener">Abrir PDF</a>
              </p>
            </object>
          </div>
        </div>
      </div>
    </section>

    <!-- PARTIDAS -->
    <section id="partidas" class="view">
      <div class="card">
        <div class="title-row">
          <h2>Partidas</h2>
          <div class="filters">
            <select id="filter-stage">
              <option value="all">Todas</option>
              <option value="groups">Fase de Grupos</option>
              <option value="semifinal">Semifinais</option>
              <option value="final">Final</option>
              <option value="third">3º Lugar</option>
            </select>
          </div>
        </div>
        <div id="matches-list"></div>
      </div>

      <div id="admin-matches" class="card admin-only hidden">
        <h3>Gerenciar Partidas</h3>
        <form id="match-form" class="form">
          <input type="hidden" id="match-id"/>
          <input type="hidden" id="match-date-orig"/>
          <div class="row">
            <label>Jogador A</label>
            <select id="match-a" required></select>
            <label>Jogador B</label>
            <select id="match-b" required></select>
          </div>
          <div class="row">
            <label>Etapa</label>
            <select id="match-stage">
              <option value="groups">Fase de Grupos</option>
              <option value="semifinal">Semifinal</option>
              <option value="final">Final</option>
              <option value="third">3º Lugar</option>
            </select>
            <label>Grupo (A/B)</label>
            <select id="match-group">
              <option value="">—</option>
              <option value="A">A</option>
              <option value="B">B</option>
            </select>
          </div>
          <div class="row">
            <label>Data/Hora</label>
            <input id="match-date" type="datetime-local"/>
            <label>Código da partida</label>
            <input id="match-code" placeholder="ex.: SF1-IFMA"/>
          </div>
          <div class="row">
            <label>Resultado</label>
            <select id="match-result">
              <option value="">Pendente</option>
              <option value="A">Vitória Jogador A</option>
              <option value="B">Vitória Jogador B</option>
              <option value="draw">Empate</option>
              <option value="postponed">Jogo adiado</option>
            </select>
          </div>
          <div class="row end">
            <button type="submit" class="btn">Salvar</button>
            <button id="match-reset" type="button" class="btn ghost">Limpar</button>
            <button id="match-delete" type="button" class="btn danger">Excluir</button>
          </div>
          <div class="row" style="margin-top:12px; gap:8px;">
            <button id="btn-reset-tournament" class="btn danger">Resetar Torneio</button>
          </div>
        </form>
      </div>
    </section>

    <!-- TABELA -->
    <section id="tabela" class="view">
      <div class="grid-2">
        <div class="card">
          <h2>Tabela – Grupo A</h2>
          <div id="table-A" class="table standings"></div>
        </div>
        <div class="card">
          <h2>Tabela – Grupo B</h2>
          <div id="table-B" class="table standings"></div>
        </div>
      </div>
    </section>

    <!-- PLAYERS -->
    <section id="players" class="view">
      <div class="card">
        <h2>Buscar jogador</h2>
        <div class="row">
          <input id="player-search" placeholder="Digite para buscar…"/>
          <button id="player-search-btn" class="btn">Buscar</button>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h2>Grupo A</h2>
          <div id="players-cards-A" class="players-grid"></div>
        </div>
        <div class="card">
          <h2>Grupo B</h2>
          <div id="players-cards-B" class="players-grid"></div>
        </div>
      </div>

      <div class="card">
        <h2>Detalhes do Jogador</h2>
        <div class="row">
          <select id="player-select"></select>
        </div>
        <div id="player-details" class="player-details"></div>
      </div>

      <div id="admin-players" class="card admin-only hidden">
        <h3>Gerenciar Jogadores</h3>
        <form id="player-form" class="form">
          <input type="hidden" id="player-id"/>
          <div class="row">
            <label>Nome</label>
            <input id="player-name" required/>
            <label>Grupo</label>
            <select id="player-group" required>
              <option value="A">A</option>
              <option value="B">B</option>
            </select>
          </div>
          <div class="row end">
            <button class="btn" type="submit">Salvar</button>
            <button id="player-reset" class="btn ghost" type="button">Limpar</button>
            <button id="player-delete" class="btn danger" type="button">Excluir</button>
          </div>
        </form>
      </div>
    </section>

    <!-- PERFIL DE JOGADOR (VIEW SEPARADA) -->
    <section id="player-profile" class="view">
      <!-- Conteúdo é injetado pelo app.js (buildPlayerProfileHTML) -->
    </section>

    <!-- POSTS -->
    <section id="posts" class="view">
      <div class="card">
        <h2>Comunicados</h2>
        <div id="posts-list" class="posts"></div>
      </div>

      <div id="admin-posts" class="card admin-only hidden">
        <h3>Novo Comunicado</h3>
        <form id="post-form" class="form">
          <div class="row">
            <label>Título</label>
            <input id="post-title" required/>
          </div>
          <div class="row">
            <label>Mensagem</label>
            <textarea id="post-body" rows="4" required></textarea>
          </div>
          <div class="row end">
            <button class="btn" type="submit">Publicar</button>
          </div>
        </form>
      </div>
    </section>

    <!-- APOSTAS -->
    <section id="apostas" class="view">
      <div class="grid-2">
        <div class="card">
          <h2>Sua Carteira</h2>
          <p>Pontos por acerto: <b>+2</b></p>
          <p>Seus pontos: <b id="wallet-points">0</b></p>
        </div>

        <div class="card">
          <h2>Nova Aposta</h2>
          <form id="bet-form" class="form">
            <div class="row">
              <label>Partida</label>
              <select id="bet-match" required>
                <option value="">— selecione —</option>
              </select>
            </div>
            <div class="row">
              <label>Palpite</label>
              <select id="bet-pick" required>
                <option value="">— selecione —</option>
                <option value="A">Vitória do Jogador A</option>
                <option value="B">Vitória do Jogador B</option>
                <option value="draw">Empate</option>
              </select>
            </div>
            <div class="row end">
              <button class="btn" type="submit">Apostar</button>
            </div>
            <p class="muted">Apostas só são permitidas antes do horário da partida.</p>
          </form>
        </div>
      </div>

      <div class="card">
        <h2>Suas Apostas</h2>
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Partida</th>
                <th>Etapa/Grupo</th>
                <th>Palpite</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="bets-list">
              <tr><td colspan="4" class="muted">Sem apostas.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CHAT -->
    <section id="chat" class="view">
      <div class="card">
        <h2>Chat da Comunidade</h2>
        <p class="muted">Apenas usuários logados podem enviar. Mensagens expiram após 24h.</p>
        <div id="chat-list" class="chat-list"></div>
        <form id="chat-form" class="form chat-form">
          <div class="row">
            <label>Mensagem</label>
            <input id="chat-text" placeholder="Escreva aqui..." maxlength="500"/>
          </div>
          <div class="row end">
            <button class="btn" type="submit">Enviar</button>
          </div>
        </form>
        <p id="chat-login-hint" class="muted hidden">Entre para participar do chat.</p>
      </div>
    </section>

    <!-- PERFIL -->
    <section id="perfil" class="view">
      <div class="card">
        <h2>Seu Perfil</h2>
        <form id="profile-form" class="form">
          <div class="row">
            <label>Nome de exibição</label>
            <input id="profile-name" placeholder="Seu nome"/>
            <label>E-mail</label>
            <input id="profile-email" disabled/>
          </div>
          <p><b>Username:</b> <span id="profile-username">—</span></p>
          <div class="row end">
            <button class="btn" type="submit">Salvar</button>
          </div>
        </form>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="admin" class="view">
      <div class="grid-2">
        <div class="card">
          <h2>Semifinais</h2>
          <p>Preencha manualmente ou use <b>Auto (Top 2)</b>.</p>
          <div class="row">
            <button id="semi-autofill" class="btn ghost">Auto (Top 2)</button>
          </div>
          <form id="semi-form" class="form">
            <div class="row">
              <label>Semi 1 – 1ºA × 2ºB</label>
              <select id="semi1-a"></select>
              <select id="semi1-b"></select>
            </div>
            <div class="row">
              <label>Semi 2 – 1ºB × 2ºA</label>
              <select id="semi2-a"></select>
              <select id="semi2-b"></select>
            </div>
            <div class="row">
              <label>Código padrão</label>
              <input id="semi-code" placeholder="ex.: SF-IFMA"/>
            </div>
            <div class="row end">
              <button class="btn" id="semi-save" type="button">Criar Semifinais</button>
            </div>
          </form>

          <div class="table" id="semi-list" style="margin-top:12px"></div>
        </div>

        <div class="card">
          <h2>Ferramentas</h2>
          <button id="seed-btn" class="btn ghost">Seed de Exemplo</button>
          <p class="muted">Preenche jogadores/rodadas de teste.</p>
        </div>
      </div>

      <!-- IMPORTANTE: ID diferente para não colidir com #admin-matches da aba Partidas -->
      <div id="admin-matches-admin" class="card admin-only hidden" style="margin-top:16px;">
        <h3>Gerenciar Partidas (atalho)</h3>
        <p class="muted">Use a aba <b>Partidas</b> para editar/gerenciar. Este bloco é apenas informativo.</p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <span>© Champions Chess IFMA</span>
  </footer>

  <script type="module" src="app.js"></script>
</body>
</html>

